# COMPILER = g++
# COMPILER_Flags = -c -g -Wall -stdo=c++17 -m32

# COMPILER_Flags += -W

# COMPILER_Flags += -fno-sanitize=address

# COMPILER_Flags += -fno-stack-protector

# CPP_FILES = echoServer.cpp

# RUN_FILE = echo.exe


# build:
# 	# disable ASLR
# 	echo 0 | sudo tee /proc/sys/kernel/randomize_va_space
# 	# compiles .cpp to object file .o
# 	$(COMPILER) $(COMPILER_FLAGS) $(CPP_FILES)
# 	# builds executable from object files
# 	$(COMPILER) $(BUILD_FLAGS) -o $(RUN_FILE) *.o
# 	sudo chown root:root $(RUN_FILE)
# 	sudo chmod u+s $(RUN_FILE)

# # all: $(RUN_FILE)

# # $(RUN_FILE): $(CPP_FILES)
# # 	$(COMPILER) $(COMPILER_Flags) -o $@ $(CPP_FILES)

# run: $(RUN_FILE)
# 	./$(RUN_FILE)

# clean:
# 	rm -f $(RUN_FILE)

# .PHONY: all run clean

# rule for compiling program

COMPILER = g++
COMPILER_FLAGS = -c -g -Wall -std=c++17 -m32
BUILD_FLAGS = -m32 -fno-stack-protector -z execstack -no-pie

# list .cpp files separated by space
CPP_FILES = echoServer.cpp

# executable program name
PROGRAM_NAME = echo.exe

# rule for compiling and building program
# make or make all triggers the following rule
build:
	# disable ASLR
	echo 0 | sudo tee /proc/sys/kernel/randomize_va_space
	# compiles .cpp to object file .o
	$(COMPILER) $(COMPILER_FLAGS) $(CPP_FILES)
	# builds executable from object files
	$(COMPILER) $(BUILD_FLAGS) -o $(PROGRAM_NAME) *.o
	sudo chown root:root $(PROGRAM_NAME)
	sudo chmod u+s $(PROGRAM_NAME)


# rule for running programming
# make run triggers the following rule
run:
	./$(PROGRAM_NAME)

# rule for clean up
# make clean triggers the following rule
clean:
	rm -f $(PROGRAM_NAME) *.o